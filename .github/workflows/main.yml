on: push
name: Deploy Azure AKS
jobs:
    deploy:
        name: Deploy to Azure AKS
        runs-on: ubuntu-latest
        steps:
        - name: Checkout code
        - uses: actions/checkout@v2

        - name: Build and push to docker hub
            uses: docker/build-push-action@v2
            with:
            context: .
            push: true
            tags: mydockerhubusername/myapp:latest
    
        - name: Set up Azure CLI
            uses: azure/setup-azure-cli@v1
            with:
            version: '2.0.81'
    
        - name: Login to Azure
            uses: azure/login@v1
            with:
            creds: ${{ secrets.AZURE_CREDENTIALS }}
    
        - name: Deploy to AKS
            run: |
            az aks get-credentials --resource-group myResourceGroup --name myAKSCluster
            kubectl apply -f k8s/deployment.yaml
